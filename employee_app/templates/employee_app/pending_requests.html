{% extends 'employee_app/base.html' %}

{% block page_title %}Review Biodata Requests{% endblock %}

{% block content %}
{% load static %}

<div class="content-area">
  <div class="content-card">
    <div class="card-header">
      <h2>Public Bio Data Submissions</h2>
      <p class="card-subtitle">Review and approve/reject employee applications submitted via public form</p>
    </div>

    <div class="list-controls">
      <input type="text" id="searchRequests" placeholder="Search by name, email or phone..." class="search-input" onkeyup="searchRequests()">
      <select id="statusFilter" class="role-filter" onchange="filterRequests()">
        <option value="">All Status</option>
        <option value="pending">Pending</option>
        <option value="approved">Approved</option>
        <option value="rejected">Rejected</option>
      </select>
    </div>

    <div class="table-container">
      <div class="table-wrapper">
        <table class="employees-biodata-table">
          <thead>
            <tr>
              <th>S.No</th>
              <th>Applicant Name</th>
              <th>Email</th>
              <th>Phone</th>
              <th>Submitted On</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="requestsTableBody">
            {% for request in requests %}
            <tr data-name="{{ request.first_name }} {{ request.middle_name|default:'' }} {{ request.last_name }}" 
                data-email="{{ request.personal_email }}" 
                data-status="{{ request.status }}">
              <td>{{ forloop.counter }}</td>
              <td>
                <div class="user-cell">
                  <div class="user-avatar">
                    {{ request.first_name|slice:":1" }}{{ request.last_name|slice:":1" | upper }}
                  </div>
                  <span>
                    {{ request.first_name }} 
                    {{ request.middle_name|default:'' }} 
                    {{ request.last_name }}
                  </span>
                </div>
              </td>
              <td>{{ request.personal_email }}</td>
              <td>{{ request.contact_number }}</td>
              <td>{{ request.created_at|date:"d M Y" }}</td>
              <td><span class="status-badge {{ request.get_status_class }}">{{ request.get_status_display }}</span></td>
              <td>
                <a href="{% url 'employee_app:review_biodata_detail' request.pk %}" class="action-icon-btn" title="Review">üëÅÔ∏è</a>
                <a href="{% url 'employee_app:delete_pending_request' request.pk %}" class="action-icon-btn" title="Delete">üóëÔ∏è</a>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="7" style="text-align:center; padding:50px;">No requests found</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <div class="table-pagination">
      <button class="pagination-btn" onclick="prevPage()">Previous</button>
      <span class="pagination-info"><span class="current-page">1</span> / <span class="total-pages">1</span></span>
      <button class="pagination-btn" onclick="nextPage()">Next</button>
    </div>

    <div class="export-buttons" style="margin-top: 25px; text-align: right;">
      <button class="btn btn-excel">Export Excel</button>
      <button class="btn btn-pdf">Export PDF</button>
    </div>
  </div>
</div>

<script>
  // Simple client-side search & filter
  function searchRequests() {
    const term = document.getElementById('searchRequests').value.toLowerCase();
    const rows = document.querySelectorAll('#requestsTableBody tr');
    rows.forEach(row => {
      const text = row.textContent.toLowerCase();
      row.style.display = text.includes(term) ? '' : 'none';
    });
  }

  function filterRequests() {
    const status = document.getElementById('statusFilter').value;
    const rows = document.querySelectorAll('#requestsTableBody tr');
    rows.forEach(row => {
      const rowStatus = row.dataset.status;
      row.style.display = (status === '' || rowStatus === status) ? '' : 'none';
    });
  }
</script>

{% endblock %}