{% extends 'employee_app/base.html' %}

{% block page_title %}Session Details: {{ session.title }}{% endblock %}

{% block content %}
<div class="content-area">
  <div class="content-card">

    <!-- Header -->
    <div class="card-header">
      <h2>Session Details: {{ session.title }}</h2>
      <p class="card-subtitle">Complete information about this training session</p>
      <div class="header-action">
        {% if request.user in session.batch.trainers.all or request.user.role == 'admin' or request.user.role == 'super_admin' %}
          <a href="{% url 'employee_app:edit_session' session.pk %}" class="btn btn-primary">Edit Session</a>
        {% endif %}
      </div>
    </div>

    <!-- Basic Session Info (Table like your static example) -->
    <div class="section-block">
      <div class="section-header">
        <h3>Session Information</h3>
      </div>
      <div class="table-responsive">
        <table class="table table-borderless pv-table">
          <tbody>
            <tr>
              <th>Title</th>
              <td>{{ session.title }}</td>
            </tr>
            <tr>
              <th>Batch</th>
              <td><a href="{% url 'employee_app:batch_detail' session.batch.pk %}">{{ session.batch.name }}</a></td>
            </tr>
            <tr>
              <th>Date & Time</th>
              <td>{{ session.date_time|date:"d M Y, H:i" }}</td>
            </tr>
            <tr>
              <th>Duration</th>
              <td>{{ session.duration_hours }} hours</td>
            </tr>
            <tr>
              <th>Topic / Agenda</th>
              <td>{{ session.agenda|linebreaks|default:"Not Provided" }}</td>
            </tr>
            <tr>
              <th>Status</th>
              <td>
                <span class="status-badge {{ session.status }}">{{ session.get_status_display }}</span>
              </td>
            </tr>
            <tr>
              <th>Location / Link</th>
              <td>
                {% if session.meeting_link %}
                  <a href="{{ session.meeting_link }}" target="_blank" class="text-primary">Join Meeting</a>
                {% else %}
                  Not Provided
                {% endif %}
              </td>
            </tr>
            {% comment %} <tr>
              <th>Materials</th>
              <td>
                {% if session.material_set.exists %}
                  {% for material in session.material_set.all %}
                    <a href="{{ material.file.url }}" target="_blank" class="me-2">{{ material.description|default:material.file.name|truncatechars:20 }}</a>
                  {% endfor %}
                {% else %}
                  No materials uploaded
                {% endif %}
              </td>
            </tr> {% endcomment %}
            <tr>
              <th>Attendance</th>
              <td>
                {% if session.attendance_taken %}
                  {{ session.attendance_percentage }}% Present
                {% else %}
                  Not Taken
                {% endif %}
              </td>
            </tr>
            <tr>
              <th>Created By</th>
              <td>{{ session.created_by.full_name|default:session.created_by.email }}</td>
            </tr>
            <tr>
              <th>Created Date</th>
              <td>{{ session.created_at|date:"d M Y" }}</td>
            </tr>
            <tr>
              <th>Last Updated</th>
              <td>{{ session.updated_at|date:"d M Y" }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Attendance Details Table -->
   <!-- Inside the Attendance Section -->
    <div class="section-block">
      <div class="section-header">
        <h3>Attendance</h3>
        {% if request.user in session.batch.trainers.all or request.user.role == 'admin' or request.user.role == 'super_admin' %}
          <a href="{% url 'employee_app:mark_attendance' session.pk %}" class="btn btn-success">
            {% if session.attendance_taken %}Update Attendance{% else %}Mark Attendance{% endif %}
          </a>
        {% endif %}
      </div>

      {% if session.attendance_taken %}
        <!-- Attendance Table (same as before) -->
        <div class="table-container">
          <table class="employees-biodata-table">
            <thead>
              <tr>
                <th>Employee Name</th>
                <th>Email</th>
                <th>Status</th>
                <th>Notes</th>
                <th>Marked By</th>
              </tr>
            </thead>
            <tbody>
              {% for record in attendance_records %}
                <tr>
                  <td>{{ record.employee.full_name|default:record.employee.email }}</td>
                  <td>{{ record.employee.email }}</td>
                  <td><span class="status-badge {{ record.status }}">{{ record.get_status_display }}</span></td>
                  <td>{{ record.notes|default:"—" }}</td>
                  <td>{{ record.marked_by.full_name|default:record.marked_by.email|default:"—" }}</td>
                </tr>
              {% empty %}
                <tr><td colspan="5" class="text-center py-4">No attendance records.</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <div class="alert alert-info text-center py-4">
          Attendance not yet marked for this session.
          {% if request.user in session.batch.trainers.all or request.user.role == 'admin' or request.user.role == 'super_admin' %}
            <div class="mt-3">
              <a href="{% url 'employee_app:mark_attendance' session.pk %}" class="btn btn-success">Mark Attendance Now</a>
            </div>
          {% endif %}
        </div>
      {% endif %}
    </div>

    <!-- Actions -->
    <div class="form-actions text-center mt-5">
      <a href="{% url 'employee_app:batch_detail' session.batch.pk %}" class="btn btn-secondary">Back to Batch</a>
    </div>
  </div>
</div>


<style>
  /* For the info table like your static example */
.pv-table {
  width: 100%;
  border-collapse: collapse;
}

.pv-table th,
.pv-table td {
  padding: 12px 15px;
  border-bottom: 1px solid #e2e8f0;
  text-align: left;
}

.pv-table th {
  font-weight: 600;
  color: #334155;
  width: 35%;
  background: #f8fafc;
}

.pv-table td {
  color: #1e293b;
}

.pv-table tr:last-child td,
.pv-table tr:last-child th {
  border-bottom: none;
}
</style>
{% endblock %}